<!DOCTYPE html
	PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">

<head>
	<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
	<style>
		body {
			margin: 0;
			padding: 0;
			overflow: hidden;
		}
	</style>
	<title>play</title>
</head>

<body onselectstart="return false">
	<canvas id='cas' style="background-color:rgba(0,5,24,1)">浏览器不支持canvas</canvas>
	</div>
	<script>
		var canvas = document.getElementById("cas");
		var ctx = canvas.getContext("2d");
		canvas.width = window.innerWidth;
		canvas.height = window.innerHeight;
		var bigbooms = [];

		window.onload = function () {
			initAnimate();
		};

		function initAnimate () {
			lastTime = new Date();
			index = 0;
			animate();
		}

		function animate () {

			var newTime = new Date();
			// 1s， 但是 index < 5
			// 生成烟花
			if (newTime - lastTime > 1000 && index < 1) {
				var bigboom = new Boom(
					canvas.width / 2, // x (横坐标，发射点)
					2, // 半径 r
					"#FFF", // color
					{ x: canvas.width / 2, y: 200 }, // 爆炸点
				);
				bigbooms.push(bigboom);

				// second ++ 
				lastTime = newTime;
				index++;
			}

			bigbooms.foreach(function (index) {
				var that = this;
				// 没有爆炸
				if (!this.dead) {
					// 移动
					this._move();
					// 画一个边缘光
					// this._drawLight();
				}
				else { // 爆炸了
					this.booms.foreach(function (index) {
						this.moveTo(index);
					});
				}
			});

			raf(animate);
		}
		var raf = window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame || function (callback) { window.setTimeout(callback, 1000 / 60); };

		Array.prototype.foreach = function (callback) {
			for (var i = 0; i < this.length; i++) {
				if (this[i] !== null) callback.apply(this[i], [i]);
			}
		};


		var Boom = function (x, r, c, boomArea, shape) {
			this.booms = [];
			this.x = x;
			this.y = (canvas.height + r);
			this.r = r;
			this.c = c;
			this.shape = shape || false;
			this.boomArea = boomArea;
			this.theta = 0;
			this.dead = false;
			this.ba = 100; // 该爆炸了？
		};
		Boom.prototype = {
			// 2 画个轨迹圆点
			_paint: function () {
				ctx.save();
				ctx.beginPath();
				ctx.arc(this.x, this.y, this.r, 0, 2 * Math.PI);
				ctx.fillStyle = this.c;
				ctx.fill();
				ctx.restore();
			},
			// 1 move 
			_move: function () {
				var dx = this.boomArea.x - this.x, dy = this.boomArea.y - this.y;
				this.x = this.x + dx * 0.01;
				this.y = this.y + dy * 0.01;
				this._paint();
			},
			// 亮光
			// _drawLight: function () {
			// 	ctx.save();
			// 	ctx.fillStyle = "rgba(255,228,150,0.3)";
			// 	ctx.beginPath();
			// 	ctx.arc(this.x, this.y, this.r + 3 * Math.random() + 1, 0, 2 * Math.PI);
			// 	ctx.fill();
			// 	ctx.restore();
			// },
		};
	</script>
</body>

</html>